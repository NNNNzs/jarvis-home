# Just A Rather Very Intelligent System (JARVIS) - Home

ä¸€ä¸ªåŸºäº **Node.js + TypeScript** çš„å¤šæ™ºèƒ½ä½“æ™ºèƒ½å®¶å±…æ§åˆ¶ç³»ç»Ÿã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ªåŸºäº LLM (LangChain/LangGraph) çš„å¤šæ™ºèƒ½ä½“ååŒç³»ç»Ÿï¼Œä½œä¸º Home Assistant çš„"æ™ºèƒ½å‰ç½®å¤§è„‘"ï¼Œå®ç°ï¼š

- ğŸ—£ï¸ **è‡ªç„¶è¯­è¨€æ§åˆ¶**: é€šè¿‡ä¸€å¥è¯æ§åˆ¶å¤šä¸ªæ™ºèƒ½è®¾å¤‡
- ğŸ§  **æ„å›¾ç†è§£**: è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·çœŸå®æ„å›¾
- ğŸ“Š **çŠ¶æ€æ„ŸçŸ¥**: å®æ—¶è·å–å®¶åº­è®¾å¤‡çŠ¶æ€
- ğŸ”„ **æµç¨‹ç¼“å­˜**: é¿å…é‡å¤æ¨ç†ï¼Œæé«˜å“åº”é€Ÿåº¦
- ğŸ”Œ **è®¾å¤‡é›†æˆ**: é€šè¿‡ Home Assistant ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è®¾å¤‡

## ğŸš€ æ ¸å¿ƒåœºæ™¯

**ç”¨æˆ·è¾“å…¥**: "æˆ‘è¦æ´—æ¾¡äº†"  
**ç³»ç»Ÿå“åº”**:
- âœ… å¼€å¯ç‡ƒæ°”çƒ­æ°´å™¨é¢„çƒ­
- âœ… æ‰“å¼€æµ´éœ¸
- âœ… æ‰“å¼€æµ´å®¤ç¯
- âœ… (å¯é€‰) æ’­æ”¾éŸ³ä¹ã€è°ƒèŠ‚æ°´æ¸©

## ğŸ“ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­éŸ³/HTTPå…¥å£ â”‚ â”€â”€> â”‚  LLM Orchestrator   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   (LangGraph)       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Intent   â”‚        â”‚ Context  â”‚        â”‚ Planner  â”‚
    â”‚ Agent    â”‚        â”‚ Agent    â”‚        â”‚ Agent    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Home Assistant   â”‚
                     â”‚   (è®¾å¤‡çŠ¶æ€&æ‰§è¡Œ) â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: TypeScript / Node.js
- **LLMæ¡†æ¶**: LangChain + LangGraph
- **APIæ¡†æ¶**: Express
- **çŠ¶æ€ç®¡ç†**: Home Assistant
- **éªŒè¯**: Zod
- **HTTPå®¢æˆ·ç«¯**: Axios
- **ç¼“å­˜**: Redis (å¯é€‰) / å†…å­˜

## ğŸ“ é¡¹ç›®ç»“æ„

```
JustARatherVeryIntelligentSystem/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/           # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ intent.ts     # æ„å›¾è¯†åˆ«
â”‚   â”‚   â”œâ”€â”€ context.ts    # çŠ¶æ€æ„ŸçŸ¥
â”‚   â”‚   â””â”€â”€ planner.ts    # è¡Œä¸ºè§„åˆ’
â”‚   â”œâ”€â”€ services/         # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ homeassistant.ts  # HA API
â”‚   â”‚   â”œâ”€â”€ llm.ts        # LLM è°ƒç”¨
â”‚   â”‚   â””â”€â”€ cache.ts      # ç¼“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ api/              # HTTP æ¥å£
â”‚   â”‚   â”œâ”€â”€ routes.ts
â”‚   â”‚   â””â”€â”€ middleware.ts
â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ app.ts            # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                # æµ‹è¯•
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡ (éœ€åˆ›å»º)
â”œâ”€â”€ tsconfig.json         # TypeScript é…ç½®
â””â”€â”€ package.json          # ä¾èµ–ç®¡ç†
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pnpm install

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
# å¤åˆ¶ä¸‹é¢çš„é…ç½®åˆ° .env æ–‡ä»¶
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹é…ç½®ï¼š

**å¿…éœ€é…ç½®**:
```bash
# OpenAI API Key (å¿…é¡»)
OPENAI_API_KEY=sk-your-api-key-here
```

**å¯é€‰é…ç½®** (å¦‚éœ€çœŸå®è®¾å¤‡æ§åˆ¶):
```bash
# Home Assistant
HOME_ASSISTANT_URL=http://homeassistant.local:8123
HOME_ASSISTANT_TOKEN=your_ha_token_here

# å…¶ä»–é…ç½®
PORT=3000
NODE_ENV=development
```

**è¯¦ç»†é…ç½®è¯´æ˜**: æŸ¥çœ‹ [docs/env-variables.md](./docs/env-variables.md)

### 3. é…ç½® Home Assistant

1. ç™»å½• Home Assistant
2. è¿›å…¥ "ç”¨æˆ·é…ç½®" â†’ "å®‰å…¨"
3. åˆ›å»º "é•¿ç”Ÿå‘½å‘¨æœŸè®¿é—®ä»¤ç‰Œ"
4. å¤åˆ¶åˆ° `.env` æ–‡ä»¶çš„ `HOME_ASSISTANT_TOKEN`

### 3. é…ç½® LLM

åœ¨ `.env` æ–‡ä»¶ä¸­å¡«å…¥ä½ çš„ OpenAI API Key (æˆ–å…¶ä»–å…¼å®¹çš„ LLM æœåŠ¡)

### 4. è¿è¡Œ

```bash
# å¼€å‘æ¨¡å¼
pnpm dev

# ç”Ÿäº§æ¨¡å¼
pnpm build
pnpm start
```

### 5. æµ‹è¯•

```bash
# å‘é€æµ‹è¯•è¯·æ±‚
curl -X POST http://localhost:3000/api/intent \
  -H "Content-Type: application/json" \
  -d '{"message": "æˆ‘è¦æ´—æ¾¡äº†"}'
```

## ğŸ“‹ API ç«¯ç‚¹

### POST /api/intent
å¤„ç†ç”¨æˆ·æ„å›¾è¾“å…¥

**è¯·æ±‚ä½“**:
```json
{
  "message": "æˆ‘è¦æ´—æ¾¡äº†"
}
```

**å“åº”**:
```json
{
  "success": true,
  "intent": "bath_prepare",
  "plan": [...],
  "execution": [...]
}
```

### GET /api/status
ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

## ğŸ¯ å¼€å‘è·¯çº¿å›¾

### Phase 1: MVP (1å‘¨)
- âœ… åŸºç¡€é¡¹ç›®ç»“æ„
- âœ… Home Assistant æ¥å…¥
- âœ… å•æ„å›¾æ”¯æŒ ("æˆ‘è¦æ´—æ¾¡äº†")
- â³ åŸºç¡€æµç¨‹æ‰§è¡Œ

### Phase 2: æ™ºèƒ½åŒ– (2å‘¨)
- â³ å¤š Agent åä½œ
- â³ ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- â³ æµç¨‹ç¼“å­˜æœºåˆ¶

### Phase 3: é«˜çº§åŠŸèƒ½
- â³ å¤šæ„å›¾æ”¯æŒ
- â³ å­¦ä¹ å‹åå¥½
- â³ å°çˆ±éŸ³ç®±é›†æˆ

## âš ï¸ é‡è¦è¯´æ˜

### å°çˆ±éŸ³ç®±æ¥å…¥
ç”±äºå°çˆ±éŸ³ç®±æ²¡æœ‰å®˜æ–¹å¼€æ”¾APIï¼Œæ¨èæ–¹æ¡ˆï¼š
- **ç±³å®¶åœºæ™¯ â†’ Webhook**: åœ¨ç±³å®¶Appä¸­åˆ›å»ºåœºæ™¯ï¼Œè§¦å‘HTTPè¯·æ±‚åˆ°æœ¬ç³»ç»Ÿ
- å›ºå®šè¯æœ¯è§¦å‘ï¼Œå¦‚ï¼š"æˆ‘è¦æ´—æ¾¡äº†"

### å®‰å…¨é™åˆ¶
- ç™½åå•è®¾å¤‡æ§åˆ¶
- é«˜é£é™©æ“ä½œéœ€è¦ç¡®è®¤
- æ‰€æœ‰æ“ä½œå¯è¿½æº¯ã€å¯å›æ»š

## ğŸ”§ å¼€å‘é…ç½®

### Cursor Rules
é¡¹ç›®å·²é…ç½® `.cursor/rules/` ç›®å½•ï¼ŒåŒ…å«ï¼š
- ä»£ç è§„èŒƒ
- æäº¤ä¿¡æ¯è§„èŒƒ
- æ¶æ„å†³ç­–è®°å½•

### ç¯å¢ƒå˜é‡
- åˆ›å»º `.env` æ–‡ä»¶ (å‚è€ƒ [docs/env-variables.md](./docs/env-variables.md))
- **é‡è¦**: `.env` æ–‡ä»¶å·²åŠ å…¥ `.gitignore`ï¼Œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

## ğŸ¤ è´¡çŒ®

è¿™æ˜¯ä¸€ä¸ª"å·¥ç¨‹å‘³å¾ˆæ­£"çš„é¡¹ç›®ï¼Œæ¬¢è¿ï¼š
- æäº¤ Issue
- æäº¤ PR
- åˆ†äº«ä½¿ç”¨åœºæ™¯

## ğŸ“ éœ€æ±‚æ–‡æ¡£

è¯¦ç»†çš„éœ€æ±‚æ–‡æ¡£å’Œè®¾è®¡æ–‡æ¡£è¯·å‚è€ƒé¡¹ç›®å†…çš„è®¨è®ºè®°å½•ï¼ŒåŒ…å«äº†å®Œæ•´çš„ï¼š
- æ¶æ„è®¾è®¡
- æŠ€æœ¯é€‰å‹ä¾æ®
- å®æ–½è·¯çº¿å›¾
- é£é™©è¯„ä¼°

## ğŸ“„ License

MIT
